{"version":3,"sources":["component-patcher.es6"],"names":[],"mappings":"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","file":"component-patcher.js","sourcesContent":["import Component from 'ui-js/core/component'\r\n\r\n\r\nexport default class ComponentPatcher {\r\n\r\n\tstatic allWrappers = []\r\n\r\n\r\n\tstatic test(target) {\r\n\t\tif (!target) return false\r\n\t\treturn ('selector' in target) || ('template' in target)\r\n\t}\r\n\r\n\r\n\tstatic patch(Class, module) {\r\n\t\ttry {\r\n\r\n\t\t\tif (module.hot.data) {\r\n\t\t\t\tvar Wrapper = module.hot.data.wrapper\r\n\t\t\t} else {\r\n\t\t\t\tvar Wrapper = this.createWrapper()\r\n\t\t\t}\r\n\r\n\t\t\tmodule.hot.dispose(data => data.wrapper = Wrapper)\r\n\t\t\tmodule.hot.accept()\r\n\r\n\t\t\tWrapper.__setClass(Class)\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tconsole.error(e)\r\n\t\t}\r\n\r\n\t\treturn Wrapper\r\n\t}\r\n\r\n\r\n\tstatic createWrapper() {\r\n\t\tvar Wrapper = this.createWrapperClass()\r\n\t\tthis.allWrappers.push(Wrapper)\r\n\t\treturn Wrapper\r\n\t}\r\n\r\n\r\n\tstatic createWrapperClass() {\r\n\r\n\r\n\t\treturn class Wrapper {\r\n\r\n\t\t\tconstructor() {\r\n\t\t\t\treturn Wrapper.__activeClass.apply(this, arguments)\r\n\t\t\t}\r\n\r\n\t\t\tstatic __inited = false\r\n\t\t\tstatic __prevStyles = null\r\n\t\t\tstatic __prevTemplate = null\r\n\t\t\tstatic __prevLogic = null\r\n\t\t\tstatic __activeClass = null\r\n\r\n\r\n\t\t\tstatic __setClass(Class) {\r\n\t\t\t\tthis.__activeClass = Class\r\n\r\n\t\t\t\tlet changedTemplate = this.__checkTemplate(Class)\r\n\t\t\t\tlet changedStyles = this.__checkStyles(Class)\r\n\t\t\t\tlet changedLogic = this.__checkLogic(Class)\r\n\r\n\t\t\t\tthis.__copyProps(Class)\r\n\r\n\t\t\t\tif (this.__inited) {\r\n\t\t\t\t\tlet inherits = this.__getInherits()\r\n\t\t\t\t\tthis.__updateStylesInInherits(inherits)\r\n\r\n\t\t\t\t\tif (changedLogic) this.__reload(inherits) // full reload\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (changedStyles) this.__reloadStyles(inherits)\r\n\t\t\t\t\t\tif (changedTemplate) this.__reloadTemplate(inherits)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.__inited = true\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __reload(inherits) {\r\n\t\t\t\tthis.reload()\r\n\t\t\t\t// console.log('reload logic inherits', inherits)\r\n\t\t\t\tfor (let inherit of inherits) inherit.reload()\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __reloadTemplate(inherits) {\r\n\t\t\t\tthis.reloadTemplate()\r\n\t\t\t\t// console.log('reload template inherits', inherits)\r\n\t\t\t\tfor (let inherit of inherits) inherit.reloadTemplate()\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __reloadStyles(inherits) {\r\n\t\t\t\tthis.reloadStyles()\r\n\t\t\t\t// console.log('reload styles inherits', inherits)\r\n\t\t\t\tfor (let inherit of inherits) inherit.reloadStyles()\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __getInherits(SuperWrapper = this, inherits = []) {\r\n\t\t\t\tfor (let Wrapper of ComponentPatcher.allWrappers) {\r\n\t\t\t\t\tif (this.__isInherit(Wrapper, SuperWrapper)) {\r\n\t\t\t\t\t\tif (inherits.indexOf(Wrapper) === -1) {\r\n\t\t\t\t\t\t\tinherits.push(Wrapper)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.__getInherits(Wrapper, inherits)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn inherits\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __isInherit(Wrapper, SuperWrapper) {\r\n\t\t\t\tlet prototype = Object.getPrototypeOf(Wrapper.prototype)\r\n\t\t\t\twhile (prototype) {\r\n\t\t\t\t\tif (prototype.constructor === SuperWrapper) {\r\n\t\t\t\t\t\treturn true\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprototype = Object.getPrototypeOf(prototype)\r\n\t\t\t\t}\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __copyProps(Class) {\r\n\t\t\t\tlet prototype = Object.getPrototypeOf(Class)\r\n\r\n\t\t\t\tif (Object.setPrototypeOf) Object.setPrototypeOf(this, prototype)\r\n\t\t\t\telse this.__proto__ = prototype\r\n\r\n\r\n\t\t\t\tfor (let prop of Object.getOwnPropertyNames(Class)) {\r\n\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(Class, prop)\r\n\t\t\t\t\tObject.defineProperty(this, prop, descriptor)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.prototype.constructor = this\r\n\r\n\t\t\t\tComponent.extend(Class)\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __updateStylesInInherits(inherits) {\r\n\t\t\t\tconsole.dir(inherits)\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __checkTemplate(Class) {\r\n\t\t\t\tlet changedTemplate = this.__prevTemplate != Class.template + ''\r\n\t\t\t\tthis.__prevTemplate = Class.template + ''\r\n\t\t\t\treturn changedTemplate\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __checkStyles(Class) {\r\n\t\t\t\tlet changedStyles = this.__prevStyles != Class.styles + ''\r\n\t\t\t\tthis.__prevStyles = Class.styles + ''\r\n\t\t\t\treturn changedStyles\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __checkLogic(Class) {\r\n\t\t\t\tlet logic = this.__getLogic(Class)\r\n\t\t\t\tlet changedLogic = this.__prevLogic != logic\r\n\t\t\t\tthis.__prevLogic = logic\r\n\t\t\t\treturn changedLogic\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __getLogic(Class) {\r\n\t\t\t\tlet code = ''\r\n\r\n\t\t\t\tfor (let prop of Object.getOwnPropertyNames(Class)) {\r\n\t\t\t\t\tif (prop === 'template' || prop === 'styles') continue\r\n\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(Class, prop)\r\n\t\t\t\t\tcode += this.__getDescriptorCode(descriptor)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let prop of Object.getOwnPropertyNames(Class.prototype)) {\r\n\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(Class.prototype, prop)\r\n\t\t\t\t\tcode += this.__getDescriptorCode(descriptor)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn code\r\n\t\t\t}\r\n\r\n\r\n\t\t\tstatic __getDescriptorCode(descriptor) {\r\n\t\t\t\tif (descriptor.hasOwnProperty('value')) {\r\n\t\t\t\t\tlet value = descriptor.value\r\n\r\n\t\t\t\t\tif (typeof value === 'function') {\r\n\t\t\t\t\t\treturn '' + descriptor.value\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn JSON.stringify(value)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn '' + descriptor.get + descriptor.set\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"]}