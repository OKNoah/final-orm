{"version":3,"sources":["schema.es6"],"names":[],"mappings":"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","file":"schema.js","sourcesContent":["import Model from './model'\r\nimport FieldType from './fields/field-type'\r\nimport FieldTypes from './fields/field-types'\r\nimport FieldModel from './fields/field-model'\r\nimport FieldModels from './fields/field-models'\r\nimport FieldSchemas from './fields/field-schemas'\r\n\r\n\r\nexport default class Schema {\r\n\r\n\r\n\tconstructor(userSchema, basePath = [], isRootSchema = true) {\r\n\t\tthis.basePath = basePath\r\n\t\tthis.fields = this.parseUserSchema(userSchema)\r\n\r\n\t\tif (isRootSchema) {\r\n\t\t\tthis.fields.push(new FieldType(basePath, ['_id'], String, null, true))\r\n\t\t\tthis.fields.push(new FieldType(basePath, ['_key'], String, null, true))\r\n\t\t\tthis.fields.push(new FieldType(basePath, ['_rev'], String, null, true))\r\n\t\t\tthis.fields.push(new FieldType(basePath, ['_removed'], Boolean, null, true))\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tparseUserSchema(userSchema, parentPath = []) {\r\n\t\tlet basePath = this.basePath\r\n\t\tlet fields = []\r\n\r\n\t\tfor (let key in userSchema) if (userSchema.hasOwnProperty(key)) {\r\n\t\t\tlet path = [...parentPath, key]\r\n\t\t\tlet value = userSchema[key]\r\n\r\n\t\t\tif ('$type' in value) {\r\n\t\t\t\tvar options = value\r\n\t\t\t\tvalue = value.$type\r\n\t\t\t} else {\r\n\t\t\t\toptions = {}\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof value === 'function') {\r\n\t\t\t\tif (value.prototype instanceof Model) {\r\n\t\t\t\t\tfields.push(new FieldModel(basePath, path, value, options))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfields.push(new FieldType(basePath, path, value, options))\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (Array.isArray(value)) {\r\n\r\n\t\t\t\tlet firstItem = value[0]\r\n\t\t\t\tif (typeof firstItem === 'function') {\r\n\t\t\t\t\tif (firstItem.prototype instanceof Model) {\r\n\t\t\t\t\t\tfields.push(new FieldModels(basePath, path, firstItem, options))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfields.push(new FieldTypes(basePath, path, firstItem, options))\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfields.push(new FieldSchemas(basePath, path, firstItem, options))\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlet subFields = this.parseUserSchema(value, path)\r\n\t\t\t\tfields.push(...subFields)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fields\r\n\t}\r\n\r\n\r\n\tvalidate(data, basePath = []) {\r\n\t\tthis.fields.forEach(field =>\r\n\t\t\tfield.validate(data, basePath)\r\n\t\t)\r\n\t}\r\n\r\n\r\n\tdocumentToModel(model, document) {\r\n\t\tthis.fields.forEach(field => {\r\n\t\t\tfield.documentToModel(model, document)\r\n\t\t})\r\n\t\treturn model\r\n\t}\r\n\r\n\r\n\tmodelToDocument(model, document) {\r\n\t\tthis.fields.forEach(field => {\r\n\t\t\tfield.modelToDocument(model, document)\r\n\t\t})\r\n\t\treturn document\r\n\t}\r\n\r\n}\r\n\r\n"]}