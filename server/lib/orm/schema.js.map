{"version":3,"sources":["schema.es6"],"names":[],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;IAGqB,M;AAGpB,iBAAY,UAAZ,EAA6C;AAAA,MAArB,YAAqB,yDAAN,IAAM;;AAAA;;AAC5C,OAAK,MAAL,GAAc,KAAK,eAAL,CAAqB,UAArB,CAAd;;AAEA,MAAI,YAAJ,EAAkB;AACjB,QAAK,MAAL,CAAY,IAAZ,CAAiB,wBAAc,CAAC,KAAD,CAAd,EAAuB,MAAvB,EAA+B,IAA/B,CAAjB;AACA,QAAK,MAAL,CAAY,IAAZ,CAAiB,wBAAc,CAAC,MAAD,CAAd,EAAwB,MAAxB,EAAgC,IAAhC,CAAjB;AACA,QAAK,MAAL,CAAY,IAAZ,CAAiB,wBAAc,CAAC,MAAD,CAAd,EAAwB,MAAxB,EAAgC,IAAhC,CAAjB;AACA,QAAK,MAAL,CAAY,IAAZ,CAAiB,wBAAc,CAAC,UAAD,CAAd,EAA4B,OAA5B,EAAqC,IAArC,CAAjB;;AAEA;AAED;;;;kCAGe,U,EAA2B;AAAA,OAAf,QAAe,yDAAJ,EAAI;;AAC1C,OAAI,SAAS,EAAb;;AAEA,QAAK,IAAI,GAAT,IAAgB,UAAhB;AAA4B,QAAI,WAAW,cAAX,CAA0B,GAA1B,CAAJ,EAAoC;AAC/D,SAAI,QAAQ,WAAW,GAAX,CAAZ;AACA,SAAI,OAAO,SAAS,MAAT,CAAgB,CAAC,GAAD,CAAhB,CAAX;;AAEA,SAAI,OAAO,KAAP,KAAiB,UAArB,EAAiC;AAChC,UAAI,MAAM,SAAN,2BAAJ,EAAsC;AACrC,cAAO,IAAP,CAAY,yBAAe,IAAf,EAAqB,KAArB,CAAZ;AACA,OAFD,MAEO;AACN,cAAO,IAAP,CAAY,wBAAc,IAAd,EAAoB,KAApB,CAAZ;AACA;AAED,MAPD,MAOO,IAAI,MAAM,OAAN,CAAc,KAAd,CAAJ,EAA0B;AAChC,UAAI,YAAY,MAAM,CAAN,CAAhB;;AAEA,UAAI,OAAO,SAAP,KAAqB,UAAzB,EAAqC;;AAEpC,WAAI,UAAU,SAAV,2BAAJ,EAA0C;AACzC,eAAO,IAAP,CAAY,0BAAgB,IAAhB,EAAsB,SAAtB,CAAZ;AACA,QAFD,MAEO;AACN,eAAO,IAAP,CAAY,yBAAe,IAAf,EAAqB,SAArB,CAAZ;AACA;AAED,OARD,MAQO;AACN,cAAO,IAAP,CAAY,2BAAiB,IAAjB,EAAuB,SAAvB,CAAZ;AACA;AAED,MAfM,MAeA;AACN,UAAI,YAAY,KAAK,eAAL,CAAqB,KAArB,EAA4B,IAA5B,CAAhB;AACA,aAAO,IAAP,kCAAe,SAAf;AACA;AACD;AA9BD,IAgCA,OAAO,MAAP;AACA;;;2BAGQ,I,EAAqB;AAAA,OAAf,QAAe,yDAAJ,EAAI;;AAC7B,QAAK,MAAL,CAAY,OAAZ,CAAoB;AAAA,WACnB,MAAM,QAAN,CAAe,IAAf,EAAqB,QAArB,CADmB;AAAA,IAApB;AAGA;;;kCAGe,K,EAAO,Q,EAAU;AAChC,QAAK,MAAL,CAAY,OAAZ,CAAoB,iBAAS;AAC5B,UAAM,eAAN,CAAsB,KAAtB,EAA6B,QAA7B;AACA,IAFD;AAGA,UAAO,KAAP;AACA;;;kCAGe,K,EAAO,Q,EAAU;AAChC,QAAK,MAAL,CAAY,OAAZ,CAAoB,iBAAS;AAC5B,UAAM,eAAN,CAAsB,KAAtB,EAA6B,QAA7B;AACA,IAFD;AAGA,UAAO,QAAP;AACA;;;;;;kBA5EmB,M","file":"schema.js","sourcesContent":["import Model from './model'\r\nimport FieldType from './fields/field-type'\r\nimport FieldTypes from './fields/field-types'\r\nimport FieldSchemas from './fields/field-schemas'\r\nimport FieldModel from './fields/field-model'\r\nimport FieldModels from './fields/field-models'\r\n\r\n\r\nexport default class Schema {\r\n\r\n\r\n\tconstructor(userSchema, isRootSchema = true) {\r\n\t\tthis.fields = this.parseUserSchema(userSchema)\r\n\r\n\t\tif (isRootSchema) {\r\n\t\t\tthis.fields.push(new FieldType(['_id'], String, true))\r\n\t\t\tthis.fields.push(new FieldType(['_key'], String, true))\r\n\t\t\tthis.fields.push(new FieldType(['_rev'], String, true))\r\n\t\t\tthis.fields.push(new FieldType(['_removed'], Boolean, true))\r\n\t\t\t// TODO сделать проверку что не может иметь такие то свойства\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tparseUserSchema(userSchema, basePath = []) {\r\n\t\tlet fields = []\r\n\r\n\t\tfor (let key in userSchema) if (userSchema.hasOwnProperty(key)) {\r\n\t\t\tlet value = userSchema[key]\r\n\t\t\tlet path = basePath.concat([key])\r\n\r\n\t\t\tif (typeof value === 'function') {\r\n\t\t\t\tif (value.prototype instanceof Model) {\r\n\t\t\t\t\tfields.push(new FieldModel(path, value))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfields.push(new FieldType(path, value))\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (Array.isArray(value)) {\r\n\t\t\t\tlet firstItem = value[0]\r\n\r\n\t\t\t\tif (typeof firstItem === 'function') {\r\n\r\n\t\t\t\t\tif (firstItem.prototype instanceof Model) {\r\n\t\t\t\t\t\tfields.push(new FieldModels(path, firstItem))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfields.push(new FieldTypes(path, firstItem))\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfields.push(new FieldSchemas(path, firstItem))\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlet subFields = this.parseUserSchema(value, path)\r\n\t\t\t\tfields.push(...subFields)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fields\r\n\t}\r\n\r\n\r\n\tvalidate(data, basePath = []) {\r\n\t\tthis.fields.forEach(field =>\r\n\t\t\tfield.validate(data, basePath)\r\n\t\t)\r\n\t}\r\n\r\n\r\n\tdocumentToModel(model, document) {\r\n\t\tthis.fields.forEach(field => {\r\n\t\t\tfield.documentToModel(model, document)\r\n\t\t})\r\n\t\treturn model\r\n\t}\r\n\r\n\r\n\tmodelToDocument(model, document) {\r\n\t\tthis.fields.forEach(field => {\r\n\t\t\tfield.modelToDocument(model, document)\r\n\t\t})\r\n\t\treturn document\r\n\t}\r\n\r\n}\r\n\r\n"]}