{"version":3,"sources":["field-models.es6"],"names":[],"mappings":"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","file":"field-models.js","sourcesContent":["import ValidationError from '../validation-error'\r\nimport FieldModel from './field-model'\r\nimport Model from \"../model\";\r\n\r\n\r\nexport default class FieldModels extends FieldModel {\r\n\r\n\r\n\tconstructor(path, Model, internal = false) {\r\n\t\tsuper(path, Model, internal)\r\n\t\tthis.arraySymbol = Symbol()\r\n\t}\r\n\r\n\r\n\tvalidate(data, basePath) {\r\n\t\tif (this.internal) return\r\n\r\n\t\tif (data instanceof Model) {\r\n\t\t\tvar array = this.getBySymbol(data, this.arraySymbol)\r\n\t\t\tif (!array) return\r\n\t\t}\r\n\t\telse {\r\n\t\t\tarray = this.getByPath(data)\r\n\t\t}\r\n\r\n\t\tif (!Array.isArray(array)) {\r\n\t\t\tthrow new ValidationError([basePath, this.path], Array, array)\r\n\t\t}\r\n\r\n\t\tarray.forEach((value, index) => {\r\n\t\t\tif (!this.validateValue(value)) {\r\n\t\t\t\tthrow new ValidationError([basePath, this.path, [index]], this.Model, value)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tdocumentToModel(model, document) {\r\n\t\tlet arrayIds = this.getByPath(document)\r\n\t\tthis.setBySymbol(model, this.symbol, arrayIds)\r\n\t\tthis.setAccessorByPath(model)\r\n\t}\r\n\r\n\r\n\tmodelToDocument(model, document) {\r\n\t\tif (this.internal) return\r\n\r\n\t\tif (model instanceof Model) {\r\n\t\t\tlet arrayIds = this.getActualIds(model)\r\n\t\t\tthis.setByPath(document, arrayIds)\r\n\t\t} else {\r\n\t\t\tlet array = this.getByPath(model)\r\n\t\t\tlet arrayIds = array.map(subModel => subModel._id)\r\n\t\t\tthis.setByPath(document, arrayIds)\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tgetActualIds(model) {\r\n\t\tvar realArray = this.getBySymbol(model, this.arraySymbol)\r\n\t\tif (realArray) {\r\n\t\t\treturn realArray.map(subModel => subModel._id)\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.getBySymbol(model, this.symbol)\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tsetAccessorByPath(model) {\r\n\t\tthis.setBySymbol(model, this.arraySymbol, null)\r\n\t\tsuper.setAccessorByPath(model)\r\n\t}\r\n\r\n\r\n\tasync fieldGetter(model) {\r\n\t\tlet realArray = this.getBySymbol(model, this.arraySymbol)\r\n\t\tif (realArray) return realArray\r\n\t\tlet arrayIds = this.getBySymbol(model, this.symbol)\r\n\t\trealArray = this.getRealModels(arrayIds)\r\n\t\tthis.setBySymbol(model, this.arraySymbol, realArray)\r\n\t\treturn realArray\r\n\t}\r\n\r\n\r\n\tasync getRealModels(arrayIds) {\r\n\t\tlet resultModels = await this.Model.getArr(arrayIds)\r\n\t\tlet subModels = {}\r\n\t\tresultModels.forEach(subModel => {\r\n\t\t\tsubModels[subModel._id] = subModel\r\n\t\t})\r\n\t\treturn arrayIds.map(id => subModels[id])\r\n\t}\r\n\r\n\r\n\tfieldSetter(model, realArray) {\r\n\t\tthis.setBySymbol(model, this.arraySymbol, realArray)\r\n\t\tthis.validate(model)\r\n\t}\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n"]}