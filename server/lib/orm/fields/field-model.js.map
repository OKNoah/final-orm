{"version":3,"sources":["field-model.es6"],"names":[],"mappings":"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","file":"field-model.js","sourcesContent":["import Field from './field'\r\nimport Model from \"../model\"\r\n\r\n\r\nexport default class FieldModel extends Field {\r\n\r\n\r\n\tconstructor(basePath, path, Model, options, internal = false) {\r\n\t\tsuper(basePath, path, options, internal)\r\n\t\tthis.Model = Model\r\n\t\tthis.symbol = Symbol()\r\n\t}\r\n\r\n\r\n\tvalidate(data, basePath) {\r\n\t\tif (this.internal) return\r\n\t\tif (data instanceof Model) return\r\n\t\tlet subModel = this.getByPath(data)\r\n\r\n\t\tif (!this.validateValue(subModel)) {\r\n\t\t\tthis.typeError(this.Model, subModel, basePath)\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tvalidateValue(value) {\r\n\t\treturn value instanceof this.Model\r\n\t}\r\n\r\n\r\n\tdocumentToModel(model, document) {\r\n\t\tlet id = this.getByPath(document)\r\n\t\tthis.setBySymbol(model, this.symbol, id)\r\n\t\tthis.setAccessorByPath(model)\r\n\t}\r\n\r\n\r\n\tmodelToDocument(model, document) {\r\n\t\tif (this.internal) return\r\n\t\tif (model instanceof Model) {\r\n\t\t\tlet id = this.getBySymbol(model, this.symbol)\r\n\t\t\tthis.setByPath(document, id)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet subModel = this.getByPath(model)\r\n\t\t\tlet id = subModel._id\r\n\t\t\tthis.setByPath(document, id)\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tsetAccessorByPath(model) {\r\n\t\tlet path = this.path.slice()\r\n\t\tlet lastProp = path.pop()\r\n\t\tlet context = model\r\n\r\n\t\tfor (let prop of path) {\r\n\t\t\tif (!context[prop]) context[prop] = {}\r\n\t\t\tcontext = context[prop]\r\n\t\t}\r\n\r\n\t\tObject.defineProperty(context, lastProp, {\r\n\t\t\t// enumerable: true,\r\n\t\t\tconfigurable: true,\r\n\t\t\tget: ()=> this.fieldGetter(model),\r\n\t\t\tset: (value)=> this.fieldSetter(model, value)\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tfieldGetter(model) {\r\n\t\tlet id = this.getBySymbol(model, this.symbol)\r\n\t\treturn this.Model.get(id)\r\n\t}\r\n\r\n\r\n\tfieldSetter(model, value) {\r\n\t\tif (!this.validateValue(value)) {\r\n\t\t\tthis.typeError(this.Model, value)\r\n\t\t}\r\n\t\tlet id = value._id\r\n\t\tthis.setBySymbol(model, this.symbol, id)\r\n\t}\r\n\r\n\r\n\tgetBySymbol(context, symbol) {\r\n\t\tlet path = this.path.slice(0, -1)\r\n\r\n\t\tfor (let prop of path) {\r\n\t\t\tcontext = context[prop]\r\n\t\t}\r\n\t\treturn context[symbol]\r\n\t}\r\n\r\n\r\n\tsetBySymbol(context, symbol, value) {\r\n\t\tlet path = this.path.slice(0, -1)\r\n\r\n\t\tfor (let prop of path) {\r\n\t\t\tif (!context[prop]) context[prop] = {}\r\n\t\t\tcontext = context[prop]\r\n\t\t}\r\n\r\n\t\treturn context[symbol] = value\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\n"]}