{"version":3,"sources":["user.es6"],"names":[],"mappings":";;AAAA;;;;AACA;;;;;;;;AAGA,iBAAW,UAAX,CAAsB,MAAtB,EAA8B;AAGvB,SAHuB,oBAGd,IAHc,EAGT;AAAA;;AAAA;AAAA,OACf,KADe,EAEf,IAFe,EAQf,IARe,EASf,OATe;AAAA;AAAA;AAAA;AAAA;AACf,YADe,GACP,KAAK,KADE;AAEf,WAFe,GAER,KAAK,IAFG;AAAA;AAAA,cAIT,eAAK,IAAL,CAAU,EAAC,YAAD,EAAV,CAJS;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKlB,aAAK,KAAL,CAAW,CAAX,EAAc,6CAAd;;AALkB;AAAA;AAAA,cAQF,eAAK,GAAL,CAAS,EAAC,YAAD,EAAQ,UAAR,EAAT,CARE;;AAAA;AAQf,WARe;AAAA;AAAA,cASC,KAAK,YAAL,EATD;;AAAA;AASf,cATe;AAAA;AAAA,cAUb,MAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,CAVa;;AAAA;AAAA,wCAYZ;AACN,iBAAS,QAAQ,MAAR,CAAe,KAAf,CADH;AAEN,cAAM,KAAK,MAAL,CAAY,OAAZ;AAFA,QAZY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBnB,EAnB4B;AAsBvB,MAtBuB,iBAsBjB,IAtBiB,EAsBZ;AAAA;;AAAA;AAAA,OACZ,KADY,EAEZ,IAFY,EAGZ,IAHY,EAaZ,OAbY;AAAA;AAAA;AAAA;AAAA;AACZ,YADY,GACJ,KAAK,KADD;AAEZ,WAFY,GAEL,KAAK,IAFA;AAAA;AAAA,cAGC,eAAK,OAAL,CAAa,EAAC,OAAO,KAAR,EAAb,CAHD;;AAAA;AAGZ,WAHY;;;AAKhB,WAAI,CAAC,IAAL,EAAW;AACV,eAAK,KAAL,CAAW,CAAX,EAAc,iBAAd;AACA;;AAED,WAAI,KAAK,SAAL,CAAe,IAAf,CAAJ,EAA0B;AACzB,eAAK,KAAL,CAAW,CAAX,EAAc,kBAAd;AACA;;AAXe;AAAA,cAaI,KAAK,YAAL,EAbJ;;AAAA;AAaZ,cAbY;AAAA;AAAA,cAcV,OAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,CAdU;;AAAA;AAAA,yCAgBT;AACN,iBAAS,QAAQ,MAAR,CAAe,KAAf,CADH;AAEN,cAAM,KAAK,MAAL,CAAY,OAAZ;AAFA,QAhBS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBhB,EA1C4B;AA6CvB,OA7CuB,oBA6Cf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cACP,OAAK,UAAL,EADO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEb,EA/C4B;AAkDvB,QAlDuB,qBAkDd;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACT,OAAK,IADI;AAAA;AAAA;AAAA;;AAAA,yCACS,IADT;;AAAA;AAAA,yCAEP,OAAK,IAAL,CAAU,MAAV,CAAiB,OAAjB,CAFO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGd;AArD4B,CAA9B","file":"user.js","sourcesContent":["import Connection from '../core/server'\r\nimport User from '../models/user'\r\n\r\n\r\nConnection.addMethods('user', {\r\n\r\n\r\n\tasync register(form){\r\n\t\tlet login = form.login\r\n\t\tlet pass = form.pass\r\n\r\n\t\tif (await User.have({login})) {\r\n\t\t\tthis.error(4, 'Пользователь с таким логином уже существует')\r\n\t\t}\r\n\r\n\t\tlet user = await User.add({login, pass})\r\n\t\tlet session = await user.startSession()\r\n\t\tawait this.setUser(user, session)\r\n\r\n\t\treturn {\r\n\t\t\tsession: session.fields('key'),\r\n\t\t\tuser: user.fields('login')\r\n\t\t}\r\n\t},\r\n\r\n\r\n\tasync login(form){\r\n\t\tlet login = form.login\r\n\t\tlet pass = form.pass\r\n\t\tlet user = await User.findOne({login: login})\r\n\r\n\t\tif (!user) {\r\n\t\t\tthis.error(2, 'Не верный логин')\r\n\t\t}\r\n\r\n\t\tif (user.checkPass(pass)) {\r\n\t\t\tthis.error(2, 'Не верный пароль')\r\n\t\t}\r\n\r\n\t\tlet session = await user.startSession()\r\n\t\tawait this.setUser(user, session)\r\n\r\n\t\treturn {\r\n\t\t\tsession: session.fields('key'),\r\n\t\t\tuser: user.fields('login')\r\n\t\t}\r\n\t},\r\n\r\n\r\n\tasync logout(){\r\n\t\tawait this.logoutUser()\r\n\t},\r\n\r\n\r\n\tasync current(){\r\n\t\tif (!this.user) return null\r\n\t\treturn this.user.fields('login')\r\n\t},\r\n\r\n\r\n})\r\n\r\n"]}