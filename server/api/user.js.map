{"version":3,"sources":["user.es6"],"names":[],"mappings":";;;;AAAA;;;;AACA;;;;AACA;;;;;;;;;;;;;;AAGA,iBAAO,GAAP,CAAW,MAAX;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,wEAGgB,MAHhB,EAGwB,UAHxB;AAAA,QAIM,KAJN,EAKM,IALN,EAWM,IAXN,EAYM,OAZN;AAAA;AAAA;AAAA;AAAA;AAIM,aAJN,GAIc,OAAO,GAAP,CAAW,OAAX,EAAoB,MAApB,EAA4B,EAAC,KAAK,CAAN,EAAS,KAAK,EAAd,EAAkB,MAAM,OAAxB,EAA5B,CAJd;AAKM,YALN,GAKa,OAAO,GAAP,CAAW,MAAX,EAAmB,MAAnB,EAA2B,EAAC,KAAK,CAAN,EAAS,KAAK,EAAd,EAAkB,MAAM,OAAxB,EAA3B,CALb;AAAA;AAAA,eAOY,eAAK,IAAL,CAAU,EAAC,YAAD,EAAV,CAPZ;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQG,aAAK,KAAL,CAAW,CAAX,EAAc,6CAAd;;AARH;AAAA;AAAA,eAWmB,eAAK,GAAL,CAAS,EAAC,YAAD,EAAQ,UAAR,EAAT,CAXnB;;AAAA;AAWM,YAXN;AAAA;AAAA,eAYsB,KAAK,YAAL,EAZtB;;AAAA;AAYM,eAZN;AAAA;AAAA,eAaQ,KAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,CAbR;;AAAA;AAAA,yCAeS;AACN,kBAAS,QAAQ,MAAR,CAAe,KAAf,CADH;AAEN,eAAM,KAAK,MAAL,CAAY,OAAZ;AAFA,SAfT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yEAsBa,MAtBb;AAAA,QAuBM,KAvBN,EAwBM,IAxBN,EA0BM,IA1BN,EAoCM,OApCN;AAAA;AAAA;AAAA;AAAA;AAuBM,aAvBN,GAuBc,OAAO,GAAP,CAAW,OAAX,EAAoB,MAApB,EAA4B,EAAC,KAAK,EAAN,EAA5B,CAvBd;AAwBM,YAxBN,GAwBa,OAAO,GAAP,CAAW,MAAX,EAAmB,MAAnB,EAA2B,EAAC,KAAK,EAAN,EAA3B,CAxBb;AAAA;AAAA,eA0BmB,eAAK,OAAL,CAAa,EAAC,OAAO,KAAR,EAAb,CA1BnB;;AAAA;AA0BM,YA1BN;;;AA4BE,YAAI,CAAC,IAAL,EAAW;AACV,cAAK,KAAL,CAAW,CAAX,EAAc,iBAAd;AACA;;AAED,YAAI,CAAC,KAAK,SAAL,CAAe,IAAf,CAAL,EAA2B;AAC1B,cAAK,KAAL,CAAW,CAAX,EAAc,kBAAd;AACA;;AAlCH;AAAA,eAoCsB,KAAK,YAAL,EApCtB;;AAAA;AAoCM,eApCN;AAAA;AAAA,eAqCQ,KAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,CArCR;;AAAA;AAAA,0CAuCS;AACN,kBAAS,QAAQ,MAAR,CAAe,KAAf,CADH;AAEN,eAAM,KAAK,MAAL,CAAY,OAAZ;AAFA,SAvCT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eA+CQ,KAAK,UAAL,EA/CR;;AAAA;AAAA,0CAgDS,IAhDT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAqDO,KAAK,IArDZ;AAAA;AAAA;AAAA;;AAAA,0CAqDyB,IArDzB;;AAAA;AAAA,0CAsDS,KAAK,IAAL,CAAU,MAAV,CAAiB,OAAjB,CAtDT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA","file":"user.js","sourcesContent":["import Server from '../core/server'\r\nimport User from '../models/user'\r\nimport API from '../core/api'\r\n\r\n\r\nServer.api('User', class extends API {\r\n\r\n\r\n\tasync register(params, connection) {\r\n\t\tlet login = params.get('login', String, {min: 3, max: 20, test: /^\\w+$/})\r\n\t\tlet pass = params.get('pass', String, {min: 3, max: 50, test: /^\\S+$/})\r\n\r\n\t\tif (await User.have({login})) {\r\n\t\t\tthis.error(4, 'Пользователь с таким логином уже существует')\r\n\t\t}\r\n\r\n\t\tlet user = await User.add({login, pass})\r\n\t\tlet session = await user.startSession()\r\n\t\tawait this.setUser(user, session)\r\n\r\n\t\treturn {\r\n\t\t\tsession: session.fields('key'),\r\n\t\t\tuser: user.fields('login')\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tasync login(params) {\r\n\t\tlet login = params.get('login', String, {max: 20})\r\n\t\tlet pass = params.get('pass', String, {max: 50})\r\n\r\n\t\tlet user = await User.findOne({login: login})\r\n\r\n\t\tif (!user) {\r\n\t\t\tthis.error(3, 'Не верный логин')\r\n\t\t}\r\n\r\n\t\tif (!user.checkPass(pass)) {\r\n\t\t\tthis.error(3, 'Не верный пароль')\r\n\t\t}\r\n\r\n\t\tlet session = await user.startSession()\r\n\t\tawait this.setUser(user, session)\r\n\r\n\t\treturn {\r\n\t\t\tsession: session.fields('key'),\r\n\t\t\tuser: user.fields('login')\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tasync logout() {\r\n\t\tawait this.logoutUser()\r\n\t\treturn true\r\n\t}\r\n\r\n\r\n\tasync current() {\r\n\t\tif (!this.user) return null\r\n\t\treturn this.user.fields('login')\r\n\t}\r\n\r\n\r\n})\r\n\r\n"]}